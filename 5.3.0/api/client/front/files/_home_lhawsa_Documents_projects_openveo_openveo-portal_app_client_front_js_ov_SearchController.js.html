<!DOCTYPE html>
<html lang="en" class="yui-overrride">
<head>
    <meta charset="utf-8">
    <title>/home/lhawsa/Documents/projects/openveo/openveo-portal/app/client/front/js/ov/SearchController.js - OpenVeo Portal client</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1 class="blue-main-title">OpenVeo Portal client</h1>
        </div>
        <div class="yui3-u-1-4 version project-version">
            API Docs for: 5.3.0
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/applicationService.html">applicationService</a></li>
                                <li><a href="../classes/authenticationService.html">authenticationService</a></li>
                                <li><a href="../classes/storageProvider.html">storageProvider</a></li>
                                <li><a href="../classes/TranslateFilter.html">TranslateFilter</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/ov.html">ov</a></li>
                                <li><a href="../modules/ov.authentication.html">ov.authentication</a></li>
                                <li><a href="../modules/ov.i18n.html">ov.i18n</a></li>
                                <li><a href="../modules/ov.portal.html">ov.portal</a></li>
                                <li><a href="../modules/ov.storage.html">ov.storage</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: /home/lhawsa/Documents/projects/openveo/openveo-portal/app/client/front/js/ov/SearchController.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x27;use strict&#x27;;

(function(app) {
  /**
   * Defines the home page controller.
   */
  function SearchController($scope, $location, $q, $filter, searchService, result, filters, $analytics) {
    var reloadOnPageChange = false;
    var canceller = $q.defer();

    $scope.videos = result.data.entities || [];
    $scope.filters = filters.data || [];
    $scope.pagination = angular.extend($scope.pagination ? $scope.pagination : {}, result.data.pagination);
    $scope.showAdvancedSearch = false;
    $scope.isLoading = false;

    /**
     * Gets search parameters from query parameters.
     *
     * @param {Object} queryParameters The key / value pairs of query parameters
     */
    function buildSearchParameters(queryParameters) {
      var searchParameters = angular.copy(queryParameters);
      if (searchParameters.dateStart) searchParameters.dateStart = new Date(Number(searchParameters.dateStart));
      if (searchParameters.dateEnd) searchParameters.dateEnd = new Date(Number(searchParameters.dateEnd));

      // Convert dateTime filters (timestamps) into dates
      for (var filter in searchParameters) {
        for (var i = 0; i &lt; $scope.filters.length; i++) {
          if (filter === $scope.filters[i].id) {
            if ($scope.filters[i].type === &#x27;dateTime&#x27;)
              searchParameters[filter] = new Date(Number(searchParameters[filter]));

            break;
          }
        }
      }

      return searchParameters;
    }

    /**
     * Search call to service
     */
    function search() {
      $scope.isLoading = true;
      if (canceller) canceller.resolve();
      canceller = $q.defer();

      var search = angular.copy($scope.search);
      var paginateParam = angular.copy($scope.pagination);

      // Convert dates into timestamps
      for (var name in search) {
        if (search[name] instanceof Date)
          search[name] = search[name].getTime();
      }

      if (search.dateEnd) {
        var dateEnd = new Date(search.dateEnd);
        dateEnd.setDate(dateEnd.getDate() + 1);
        search.dateEnd = dateEnd.getTime();
      }

      search.sortBy = search.sortBy ? &#x27;views&#x27; : &#x27;date&#x27;;
      search.sortOrder = search.sortOrder ? &#x27;asc&#x27; : &#x27;desc&#x27;;

      searchService.search(search, paginateParam, canceller).then(function(result) {
        if (result.data.error) {
          $scope.isLoading = false;
          $scope.showToast(&#x27;error&#x27;);
          return;
        }

        $scope.videos = result.data.entities;
        $scope.pagination = result.data.pagination;
        $scope.isLoading = false;
        reloadOnPageChange = true;

        var searchQuery = ($scope.search.query) ? $scope.search.query : &#x27;&#x27;;
        var searchCategories = ($scope.search.categories) ? $scope.search.categories : &#x27;&#x27;;

        $analytics.trackSiteSearch(searchQuery, searchCategories, $scope.pagination.size);
      });
    }

    $scope.search = buildSearchParameters($location.search());

    $scope.searchSubmit = function() {
      var search = angular.copy($scope.search);
      $scope.showAdvancedSearch = false;

      // Clean search parameters to avoid conflicts
      search = searchService.cleanSearch(search);

      // Convert dates into timestamps
      for (var name in search) {
        if (search[name] instanceof Date)
          search[name] = search[name].getTime();
      }

      $location.search(search);
    };

    $scope.resetSearch = function() {
      $scope.search = buildSearchParameters({query: $scope.search.query});
    };

    $scope.orderOnChange = function() {
      $scope.searchSubmit();
    };

    $scope.$watch(&#x27;pagination.pages&#x27;, function(current, old) {
      var input = [];
      for (var i = 1; i &lt;= current; i++) {
        input.push(i);
      }
      $scope.pages = input;
    });

    $scope.$watch(&#x27;pagination.page&#x27;, function(current, old) {
      $scope.pagination.page = current;
      if (reloadOnPageChange) search();
      else reloadOnPageChange = true;
    });

    $scope.$on(&#x27;$routeUpdate&#x27;, function(event, route) {
      $scope.search = buildSearchParameters($location.search());

      if (!$scope.context || !$scope.context.keepContext) {
        reloadOnPageChange = false;
        $scope.pagination.page = 0;
        search();
      } else {
        $scope.context.keepContext = false;
      }
    });
  }

  app.controller(&#x27;SearchController&#x27;, SearchController);
  SearchController.$inject = [
    &#x27;$scope&#x27;,
    &#x27;$location&#x27;,
    &#x27;$q&#x27;,
    &#x27;$filter&#x27;,
    &#x27;searchService&#x27;,
    &#x27;result&#x27;,
    &#x27;filters&#x27;,
    &#x27;$analytics&#x27;
  ];

})(angular.module(&#x27;ov.portal&#x27;));

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
