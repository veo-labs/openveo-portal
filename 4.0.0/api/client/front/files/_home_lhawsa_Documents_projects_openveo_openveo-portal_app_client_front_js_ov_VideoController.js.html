<!DOCTYPE html>
<html lang="en" class="yui-overrride">
<head>
    <meta charset="utf-8">
    <title>/home/lhawsa/Documents/projects/openveo/openveo-portal/app/client/front/js/ov/VideoController.js - OpenVeo Portal client</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1 class="blue-main-title">OpenVeo Portal client</h1>
        </div>
        <div class="yui3-u-1-4 version project-version">
            API Docs for: 4.0.0
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/applicationService.html">applicationService</a></li>
                                <li><a href="../classes/authenticationService.html">authenticationService</a></li>
                                <li><a href="../classes/storageProvider.html">storageProvider</a></li>
                                <li><a href="../classes/TranslateFilter.html">TranslateFilter</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/ov.html">ov</a></li>
                                <li><a href="../modules/ov.authentication.html">ov.authentication</a></li>
                                <li><a href="../modules/ov.i18n.html">ov.i18n</a></li>
                                <li><a href="../modules/ov.portal.html">ov.portal</a></li>
                                <li><a href="../modules/ov.storage.html">ov.storage</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: /home/lhawsa/Documents/projects/openveo/openveo-portal/app/client/front/js/ov/VideoController.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x27;use strict&#x27;;

(function(app) {

  /**
   *
   * @param {type} $scope
   * @param {type} $locale
   * @param {type} $timeout
   * @param {type} $location
   * @returns {VideoController_L3.VideoController}
   */
  function VideoController($scope,
                           $http,
                           $locale,
                           $timeout,
                           $location,
                           $analytics,
                           videoService,
                           searchService,
                           $sce,
                           webServiceBasePath) {
    $scope.defaultMode = &#x27;both&#x27;;
    if ($scope.video.metadata) {
      var template = $scope.video.metadata.template || &#x27;&#x27;;
      if (template.match(/^mix-/))
        $scope.defaultMode = &#x27;media&#x27;;
    }
    if ($scope.video.category) {
      searchService.getCategoryName($scope.video.category).then(function(val) {
        $scope.categoryName = val;
      });
    }

    $scope.dialIsOpen = false;
    $scope.language = $locale.id;
    $scope.shareOpen = false;
    $scope.shareItems = [
      {name: &#x27;UI.LINK&#x27;, icon: &#x27;link&#x27;, direction: &#x27;bottom&#x27;, action: function(video) {
        delete $scope.shareText;
        var port = ($location.port() != 80 &amp;&amp; $location.port() != 443) ? &#x27;:&#x27; + $location.port() : &#x27;&#x27;;
        $scope.shareLink = $location.protocol() + &#x27;://&#x27; + $location.host() + port + &#x27;/video/&#x27; + video.id;
        $scope.shareOpen = !$scope.shareOpen;
      }},
      {name: &#x27;UI.CODE&#x27;,
        icon: &#x27;code&#x27;,
        direction: &#x27;bottom&#x27;,
        action: function(video) {
          delete $scope.shareLink;
          var port = ($location.port() != 80 &amp;&amp; $location.port() != 443) ? &#x27;:&#x27; + $location.port() : &#x27;&#x27;;
          $scope.shareText =
                  &#x27;&lt;iframe width=&quot;768&quot; height=&quot;500&quot; &#x27; +
                  &#x27;src=&quot;&#x27; + $location.protocol() + &#x27;://&#x27; + $location.host() + port + &#x27;/video/&#x27; + video.id +
                  &#x27;?iframe=true&amp;hidedetail=false&quot; frameborder=&quot;0&quot;&gt;&lt;/iframe&gt;&#x27;;

          $scope.shareOpen = !$scope.shareOpen;
        }}
    ];
    $scope.showFullInfos = false;
    $scope.toggleFullInfosLabel = &#x27;UI.MORE&#x27;;

    $scope.toggleFullInfos = function() {
      $scope.showFullInfos = !$scope.showFullInfos;
      $scope.toggleFullInfosLabel = $scope.showFullInfos ? &#x27;UI.LESS&#x27; : &#x27;UI.MORE&#x27;;
    };

    var myPlayer = document.getElementById(&#x27;openveo-player&#x27;);
    var playerController;
    var videoDuration;

    angular.element(myPlayer).on(&#x27;needPoiConversion&#x27;, function(event, duration) {
      $http
        .post(webServiceBasePath + &#x27;videos/&#x27; + $scope.video.id + &#x27;/poi/convert&#x27;, {duration: duration})
        .then(function(response) {
          $scope.video = response.data.entity;
        });
    });

    /**
     * Executes, safely, the given function in AngularJS process.
     *
     * @param {Function} functionToExecute The function to execute as part of
     * the angular digest process.
     */
    function safeApply(functionToExecute) {

      // Execute each apply on a different loop
      $timeout(function() {

        // Make sure we&#x27;re not on a digestion cycle
        var phase = $scope.$root.$$phase;

        if (phase === &#x27;$apply&#x27; || phase === &#x27;$digest&#x27;)
          functionToExecute();
        else
          $scope.$apply(functionToExecute);
      }, 1);
    }

    angular.element(myPlayer).on(&#x27;durationChange&#x27;, function(event, duration) {
      safeApply(function() {
        videoDuration = duration;

        // only gets called once
        if (!playerController || duration) {
          playerController = angular.element(myPlayer).controller(&#x27;ovPlayer&#x27;);
        }
      });
    });

    angular.element(myPlayer).on(&#x27;ovPlay&#x27;, function(event) {
      $analytics.pageTrack($location.path());
      $analytics.eventTrack(&#x27;play&#x27;, {value: $scope.video.id});
      videoService.increaseVideoView($scope.video.id, videoDuration);
    });

    // Listen to player errors
    // If an error occurs go back to catalog with an alert
    angular.element(myPlayer).on(&#x27;error&#x27;, function(event, error) {
      $scope.$emit(&#x27;setAlert&#x27;, &#x27;danger&#x27;, error &amp;&amp; error.message, 8000);
    });

    $scope.$watch(&#x27;vctl.dialIsOpen&#x27;, function(newValue, oldValue) {
      if (newValue === true) {
        $scope.shareOpen = false;
      }
    });

    $scope.trustedHTML = function(string) {
      return $sce.trustAsHtml(string);
    };
  }

  app.controller(&#x27;VideoController&#x27;, VideoController);
  VideoController.$inject = [
    &#x27;$scope&#x27;,
    &#x27;$http&#x27;,
    &#x27;$locale&#x27;,
    &#x27;$timeout&#x27;,
    &#x27;$location&#x27;,
    &#x27;$analytics&#x27;,
    &#x27;videoService&#x27;,
    &#x27;searchService&#x27;,
    &#x27;$sce&#x27;,
    &#x27;webServiceBasePath&#x27;
  ];

})(angular.module(&#x27;ov.portal&#x27;));

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
