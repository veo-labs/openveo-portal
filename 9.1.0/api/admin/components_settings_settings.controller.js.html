<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/settings/settings.controller.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/settings/settings.controller.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

(function(app) {

  /**
   * Manages opaSettings component.
   *
   * @class OpaSettingsController
   * @memberof module:opa/settings
   * @inner
   * @constructor
   * @param {Object} $scope The component isolated scope
   * @param {Object} $q AngularJS $q service
   * @param {Object} $filter AngularJS $filter service
   * @param {Object} $element The HTML element holding the component
   * @param {Object} opaSettingsFactory Settings factory to get / save settings
   * @param {Object} opaGroupsFactory Groups factory to get available groups
   * @param {Object} opaNotificationFactory Notification factory to display saving notifications
   */
  function OpaSettingsController(
    $scope,
    $q,
    $filter,
    $element,
    opaSettingsFactory,
    opaGroupsFactory,
    opaNotificationFactory
  ) {
    var ctrl = this;
    var liveSettingsController;
    var searchSettingsController;
    var mdContentController = $element.controller &amp;&amp; $element.controller('mdContent');

    Object.defineProperties(ctrl,

      /** @lends module:opa/settings~OpaSettingsController */
      {

        /**
         * Indicates if retreiving the settings failed.
         *
         * @type {Boolean}
         * @instance
         * @default false
         */
        isError: {
          value: false,
          writable: true
        },

        /**
         * The list of OpenVeo groups with name and value.
         *
         * @type {Array}
         * @instance
         * @readonly
         */
        availableGroups: {
          value: []
        },

        /**
         * Live settings.
         *
         * @type {Object}
         * @instance
         * @default null
         */
        liveSettings: {
          value: null,
          writable: true
        },

        /**
         * Search settings.
         *
         * @type {Object}
         * @instance
         * @default null
         */
        searchSettings: {
          value: null,
          writable: true
        },

        /**
         * Initializes controller and informs when component is loaded.
         *
         * @memberof module:opa/settings~OpaSettingsController
         * @method $onInit
         * @instance
         */
        $onInit: {
          value: function() {
            $q.all([
              opaSettingsFactory.getSetting('live'),
              opaSettingsFactory.getSetting('search'),
              opaGroupsFactory.getGroups()
            ]).then(function(results) {
              var groups = results[2].data &amp;&amp; results[2].data.entities;
              ctrl.liveSettings = results[0].data &amp;&amp; results[0].data.entity &amp;&amp; results[0].data.entity.value || {};
              ctrl.searchSettings = results[1].data &amp;&amp; results[1].data.entity &amp;&amp; results[1].data.entity.value || {};

              // Build the list of available groups
              if (groups) {
                groups.forEach(function(group) {
                  ctrl.availableGroups.push({
                    name: group.name,
                    value: group.id
                  });
                });
              }

              $scope.$emit('opaViewLoaded');
            }, function(error) {
              ctrl.isError = true;
              $scope.$emit('opaViewLoaded');
            });

            $scope.$on('opaLiveSettingsLinked', function(event, data) {
              liveSettingsController = data.controller;
            });

            $scope.$on('opaSearchSettingsLinked', function(event, data) {
              searchSettingsController = data.controller;
            });

            // If the component is inside an md-content element the only way to have a background color
            // which spread all along the height of the md-content is to set the background color
            // on the md-content itself. This is due to flexbox behaviour when having a flex container with
            // stretch items, if items haven't an intrinsic height they shrink. As we want the child to
            // stretch to an indeterminated height (the height of the container) it is not possible to specify
            // the child height. A way to solve the problem will be to use experimental features such as
            // "width: fit-content;". Instead we add a class on the md-content parent element.
            if (mdContentController)
              mdContentController.$element.addClass('opa-settings-wrapper');
          }

        },

        /**
         * Saves current settings.
         *
         * @memberof module:opa/settings~OpaSettingsController
         * @method save
         * @instance
         */
        save: {
          value: function() {
            ctrl.isSaving = true;

            $q.all([
              opaSettingsFactory.updateSetting('live', ctrl.liveSettings),
              opaSettingsFactory.updateSetting('search', ctrl.searchSettings)
            ]).then(function() {
              ctrl.isSaving = false;
              opaNotificationFactory.displayNotification($filter('opaTranslate')('SETTINGS.SAVE_SUCCESS'), 1000);
            }, function(error) {
              ctrl.isSaving = false;
            });
          }
        },

        /**
         * Updates live settings.
         *
         * @memberof module:opa/settings~OpaSettingsController
         * @method updateLiveSettings
         * @param {Object} settings Live settings
         * @param {Boolean} settings.activated true if live is activated, false otherwise
         * @param {String} settings.playerType Either "youtube", "wowza" or "vodalys"
         * @param {String} settings.url Live stream URL
         * @param {Boolean} settings.private true if live is private, false otherwise
         * @param {Array} settings.groups The list of groups allowed to access the live
         * @instance
         */
        updateLiveSettings: {
          value: function(settings) {
            if (!settings || !ctrl.liveSettings) return;
            ctrl.liveSettings.activated = settings.activated;
            ctrl.liveSettings.playerType = settings.playerType;
            ctrl.liveSettings.url = settings.url;
            ctrl.liveSettings.private = settings.private;
            ctrl.liveSettings.groups = settings.groups;
          }
        },

        /**
         * Updates search settings.
         *
         * @memberof module:opa/settings~OpaSettingsController
         * @method updateSearchSettings
         * @param {Object} settings Search settings
         * @param {Boolean} settings.pois true if search must be performed also in points of interest, false otherwise
         * @instance
         */
        updateSearchSettings: {
          value: function(settings) {
            if (!settings || !ctrl.searchSettings) return;
            ctrl.searchSettings.pois = settings.pois;
          }
        },

        /**
         * Tests if settings are valid.
         *
         * @memberof module:opa/settings~OpaSettingsController
         * @method isValid
         * @instance
         * @return {Boolean} true if valid, false otherwise
         */
        isValid: {
          value: function() {
            if (liveSettingsController &amp;&amp; searchSettingsController) {
              return liveSettingsController.isValid() &amp;&amp; searchSettingsController.isValid();
            }
            return false;
          }
        }

      }

    );
  }

  app.controller('OpaSettingsController', OpaSettingsController);
  OpaSettingsController.$inject = [
    '$scope',
    '$q',
    '$filter',
    '$element',
    'opaSettingsFactory',
    'opaGroupsFactory',
    'opaNotificationFactory'
  ];

})(angular.module('opa'));
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-opa.html">opa</a></li><li><a href="module-opa_actionsButton.html">opa/actionsButton</a></li><li><a href="module-opa_dashboard.html">opa/dashboard</a></li><li><a href="module-opa_dashboard_about.html">opa/dashboard/about</a></li><li><a href="module-opa_i18n.html">opa/i18n</a></li><li><a href="module-opa_info.html">opa/info</a></li><li><a href="module-opa_infoButton.html">opa/infoButton</a></li><li><a href="module-opa_licenseKeyValidator.html">opa/licenseKeyValidator</a></li><li><a href="module-opa_mediaContainer.html">opa/mediaContainer</a></li><li><a href="module-opa_mediaLibrary.html">opa/mediaLibrary</a></li><li><a href="module-opa_mediaLibraryDialog.html">opa/mediaLibraryDialog</a></li><li><a href="module-opa_mediaOption.html">opa/mediaOption</a></li><li><a href="module-opa_mediaSelect.html">opa/mediaSelect</a></li><li><a href="module-opa_nav.html">opa/nav</a></li><li><a href="module-opa_notification.html">opa/notification</a></li><li><a href="module-opa_promotedVideos.html">opa/promotedVideos</a></li><li><a href="module-opa_settings.html">opa/settings</a></li><li><a href="module-opa_settings_liveSettings.html">opa/settings/liveSettings</a></li><li><a href="module-opa_settings_searchSettings.html">opa/settings/searchSettings</a></li><li><a href="module-opa_streamUrlValidator.html">opa/streamUrlValidator</a></li><li><a href="module-opa_tags.html">opa/tags</a></li><li><a href="module-opa_toolbar.html">opa/toolbar</a></li></ul><h3>Classes</h3><ul><li><a href="module-opa_actionsButton-OpaActionsButtonController.html">opa/actionsButton~OpaActionsButtonController</a></li><li><a href="module-opa_dashboard_about-OpaAboutController.html">opa/dashboard/about~OpaAboutController</a></li><li><a href="module-opa_dashboard_about-OpaAboutFactory.html">opa/dashboard/about~OpaAboutFactory</a></li><li><a href="module-opa_dashboard-OpaDashboardController.html">opa/dashboard~OpaDashboardController</a></li><li><a href="module-opa_i18n-OpaI18nFactory.html">opa/i18n~OpaI18nFactory</a></li><li><a href="module-opa_i18n-OpaTranslateFilter.html">opa/i18n~OpaTranslateFilter</a></li><li><a href="module-opa_infoButton-OpaInfoButtonController.html">opa/infoButton~OpaInfoButtonController</a></li><li><a href="module-opa_info-OpaInfoConfiguration.html">opa/info~OpaInfoConfiguration</a></li><li><a href="module-opa_info-OpaInfoController.html">opa/info~OpaInfoController</a></li><li><a href="module-opa_licenseKeyValidator-OpaLicenseKeyValidatorController.html">opa/licenseKeyValidator~OpaLicenseKeyValidatorController</a></li><li><a href="module-opa_mediaContainer-OpaMediaContainerController.html">opa/mediaContainer~OpaMediaContainerController</a></li><li><a href="module-opa_mediaLibraryDialog-OpaMediaLibraryDialogController.html">opa/mediaLibraryDialog~OpaMediaLibraryDialogController</a></li><li><a href="module-opa_mediaLibrary-OpaMediaLibraryController.html">opa/mediaLibrary~OpaMediaLibraryController</a></li><li><a href="module-opa_mediaOption-OpaMediaOptionController.html">opa/mediaOption~OpaMediaOptionController</a></li><li><a href="module-opa_mediaSelect-OpaMediaSelectController.html">opa/mediaSelect~OpaMediaSelectController</a></li><li><a href="module-opa_nav-OpaNavController.html">opa/nav~OpaNavController</a></li><li><a href="module-opa_notification-OpaNotificationConfiguration.html">opa/notification~OpaNotificationConfiguration</a></li><li><a href="module-opa_notification-OpaNotificationController.html">opa/notification~OpaNotificationController</a></li><li><a href="module-opa_notification-OpaNotificationFactory.html">opa/notification~OpaNotificationFactory</a></li><li><a href="module-opa_promotedVideos-OpaPromotedVideosController.html">opa/promotedVideos~OpaPromotedVideosController</a></li><li><a href="module-opa_settings_liveSettings-OpaLiveSettingsController.html">opa/settings/liveSettings~OpaLiveSettingsController</a></li><li><a href="module-opa_settings_searchSettings-OpaSearchSettingsController.html">opa/settings/searchSettings~OpaSearchSettingsController</a></li><li><a href="module-opa_settings-OpaSettingsController.html">opa/settings~OpaSettingsController</a></li><li><a href="module-opa_streamUrlValidator-OpaStreamUrlValidatorController.html">opa/streamUrlValidator~OpaStreamUrlValidatorController</a></li><li><a href="module-opa_tags-OpaTagsController.html">opa/tags~OpaTagsController</a></li><li><a href="module-opa_toolbar-OpaToolbarController.html">opa/toolbar~OpaToolbarController</a></li><li><a href="module-opa-OpaGroupsFactory.html">opa~OpaGroupsFactory</a></li><li><a href="module-opa-OpaIndexController.html">opa~OpaIndexController</a></li><li><a href="module-opa-OpaInterceptor.html">opa~OpaInterceptor</a></li><li><a href="module-opa-OpaSettingsFactory.html">opa~OpaSettingsFactory</a></li><li><a href="module-opa-OpaUrlFactory.html">opa~OpaUrlFactory</a></li><li><a href="module-opa-OpaUserFactory.html">opa~OpaUserFactory</a></li><li><a href="module-opa-OpaVideosFactory.html">opa~OpaVideosFactory</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Tue Apr 19 2022 10:18:39 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
