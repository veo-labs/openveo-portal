<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.controller.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: index.controller.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

(function(app) {

  /**
   * Defines the main controller of the OpenVeo Portal administration interface.
   *
   * @class OpaIndexController
   * @memberof module:opa
   * @inner
   * @constructor
   * @param {Object} $scope AngularJS scope
   * @param {Object} $route AngularJS $route service
   * @param {Object} $window AngularJS $window service
   * @param {Object} $location AngularJS $location service
   * @param {Object} $filter AngularJS $filter service
   * @param {Object} $mdMedia AngularJS Material service to evaluate media queries
   * @param {Object} $mdSidenav AngularJS Material service to manipulate sidenav directives
   * @param {Object} opaUserFactory User factory to deal with the authenticated user
   * @param {Object} opaI18nFactory I18n factory to manage languages
   * @param {Object} opaNotificationFactory Notification factory
   */
  function OpaIndexController(
    $scope,
    $route,
    $window,
    $location,
    $filter,
    $mdMedia,
    $mdSidenav,
    opaUserFactory,
    opaI18nFactory,
    opaNotificationFactory
  ) {
    var ctrl = this;
    var translateFilter = $filter('opaTranslate');

    Object.defineProperties(ctrl,

      /** @lends module:opa~OpaIndexController */
      {

        /**
         * Information about the page.
         *
         * @type {Object}
         * @instance
         * @readonly
         */
        page: {
          value: {}
        },

        /**
         * Title of the administration interface as a translation id.
         *
         * @type {Object}
         * @instance
         * @readonly
         * @default 'HEADER.TITLE'
         */
        adminTitle: {
          value: 'HEADER.TITLE'
        },

        /**
         * AngularJS Material $mdMedia service.
         *
         * @type {Object}
         * @instance
         * @readonly
         */
        $mdMedia: {
          value: $mdMedia
        },

        /**
         * Menu links.
         *
         * @type {Array}
         * @instance
         * @readonly
         */
        menuLinks: {
          value: []
        },

        /**
         * The list of left actions for the toolbar.
         *
         * @type {Array}
         * @instance
         * @readonly
         */
        toolbarLeftActions: {
          value: []
        },

        /**
         * The list of right actions for the toolbar.
         *
         * @type {Array}
         * @instance
         * @readonly
         */
        toolbarRightActions: {
          value: []
        },

        /**
         * The list of right actions for the advanced toolbar.
         *
         * @type {Array}
         * @instance
         * @readonly
         */
        advancedToolbarRightActions: {
          value: []
        },

        /**
         * Languages actions for the advanced toolbar.
         *
         * @type {Array}
         * @instance
         * @readonly
         */
        advancedToolbarLanguageActions: {
          value: []
        },

        /**
         * Toolbar page info.
         *
         * Holds the configuration of the toolbar info action button which presents an information about the actual
         * page. Information message changes with the router page.
         *
         * @type {Object}
         * @instance
         * @readonly
         */
        toolbarPageInfo: {
          value: {
            type: 'info',
            message: null,
            accessibility: translateFilter('HEADER.INFO_ACCESSIBILITY'),
            help: translateFilter('HEADER.INFO_TOOLTIP')
          }
        },

        /**
         * Navigation menu for opa-nav component.
         *
         * @type {Array}
         * @instance
         * @readonly
         */
        navMenu: {
          value: []
        },

        /**
         * Advanced navigation menu for opa-nav component.
         *
         * @type {Array}
         * @instance
         * @readonly
         */
        advancedNavMenu: {
          value: []
        },

        /**
         * User's language.
         *
         * @type {String}
         * @instance
         * @readonly
         */
        userLanguage: {
          value: opaUserFactory.getLanguage() || opaI18nFactory.getLanguages()[0]
        },

        /**
         * Indicates if ng-view is loaded or not.
         *
         * true if view is loaded, false if it is currently loading.
         *
         * @type {Boolean}
         * @instance
         * @readonly
         */
        isViewLoaded: {
          value: false,
          writable: true
        },

        /**
         * Initializes properties for sub components.
         *
         * @memberof module:opa~OpaIndexController
         * @method init
         * @instance
         */
        init: {
          value: function() {
            var navLanguagesActions = [];
            var navDashboardAction = {
              label: translateFilter('NAV.DASHBOARD'),
              icon: 'dashboard',
              action: ctrl.goTo,
              href: '/'
            };
            var navSettingsAction = {
              label: translateFilter('NAV.SETTINGS'),
              icon: 'settings',
              action: ctrl.goTo,
              href: '/settings'
            };
            var navPromotedVideosAction = {
              label: translateFilter('NAV.PROMOTED_VIDEOS'),
              icon: 'view_quilt',
              action: ctrl.goTo,
              href: '/promoted-videos'
            };

            opaI18nFactory.getLanguages().forEach(function(language) {
              ctrl.advancedToolbarLanguageActions.push({
                label: translateFilter('HEADER.LANGUAGES.' + language),
                accessibility: translateFilter('HEADER.LANGUAGES.' + language + '_ACCESSIBILITY'),
                code: language,
                action: ctrl.setLanguage,
                selected: language === ctrl.userLanguage
              });
              navLanguagesActions.push({
                label: translateFilter('NAV.LANGUAGES.' + language),
                code: language,
                action: ctrl.setLanguage,
                selected: language === ctrl.userLanguage
              });
            });

            ctrl.toolbarLeftActions.push(
              {
                type: 'icon',
                accessibility: translateFilter('HEADER.TOGGLE_MENU_ACCESSIBILITY'),
                help: translateFilter('HEADER.TOGGLE_MENU_TOOLTIP'),
                icon: 'menu',
                action: ctrl.toggleSideNavigation
              }
            );

            ctrl.toolbarRightActions.push(ctrl.toolbarPageInfo);

            ctrl.advancedToolbarRightActions.push(
              {
                type: 'icon',
                accessibility: translateFilter('HEADER.VIEW_PORTAL_ACCESSIBILITY'),
                help: translateFilter('HEADER.VIEW_PORTAL_TOOLTIP'),
                icon: 'visibility',
                action: ctrl.goToPortal
              },
              {
                type: 'list',
                accessibility: translateFilter('HEADER.TOGGLE_LANGUAGES_ACCESSIBILITY'),
                help: translateFilter('HEADER.TOGGLE_LANGUAGES_TOOLTIP'),
                icon: 'language',
                menu: ctrl.advancedToolbarLanguageActions
              },
              {
                type: 'list',
                accessibility: translateFilter('HEADER.TOGGLE_USER_ACTIONS_ACCESSIBILITY'),
                help: translateFilter('HEADER.TOGGLE_USER_ACTIONS_TOOLTIP'),
                icon: 'account_circle',
                menu: [
                  {
                    label: translateFilter('HEADER.USER_ACTIONS.DISCONNECT'),
                    accessibility: translateFilter('HEADER.USER_ACTIONS.DISCONNECT_ACCESSIBILITY'),
                    action: ctrl.logout
                  }
                ]
              }
            );

            ctrl.navMenu.push(navDashboardAction, navPromotedVideosAction, navSettingsAction);

            ctrl.advancedNavMenu.push(
              navDashboardAction,
              navPromotedVideosAction,
              navSettingsAction,
              {
                divider: true
              },
              {
                label: translateFilter('NAV.VIEW_PORTAL'),
                icon: 'visibility',
                action: ctrl.goToPortal
              },
              {
                label: translateFilter('NAV.LANGUAGE'),
                icon: 'language',
                actions: navLanguagesActions
              },
              {
                divider: true
              },
              {
                label: translateFilter('NAV.LOGOUT'),
                icon: 'power_settings_new',
                action: ctrl.logout
              }
            );
          }
        },

        /**
         * Logs out current user.
         *
         * @memberof module:opa~OpaIndexController
         * @method logout
         * @instance
         */
        logout: {
          value: function() {
            opaUserFactory.logout().then(function() {
              ctrl.goToPortal();
            });
          }
        },

        /**
         * Navigates to a back office page.
         *
         * @memberof module:opa~OpaIndexController
         * @method goTo
         * @instance
         * @param {Object} item The menu item
         * @param {String} item.href The path to navigate to
         */
        goTo: {
          value: function(item) {
            $location.path(item.href);
            ctrl.closeSideNavigation();
          }
        },

        /**
         * Navigates to the front office of the portal.
         *
         * @memberof module:opa~OpaIndexController
         * @method goToPortal
         * @instance
         */
        goToPortal: {
          value: function() {
            $window.location.href = '/';
          }
        },

        /**
         * Sets user's language.
         *
         * @memberof module:opa~OpaIndexController
         * @method setLanguage
         * @instance
         * @param {Object} language A language description object
         * @param {String} language.code The language country code
         */
        setLanguage: {
          value: function(language) {
            opaUserFactory.setLanguage(language.code);
            $window.location.href = '/be' + $location.path();
          }
        },

        /**
         * Closes side navigation.
         *
         * @memberof module:opa~OpaIndexController
         * @method closeSideNavigation
         * @instance
         */
        closeSideNavigation: {
          value: function() {
            $mdSidenav('opa').close();
          }
        },

        /**
         * Opens / closes side navigation.
         *
         * @memberof module:opa~OpaIndexController
         * @method toggleSideNavigation
         * @instance
         */
        toggleSideNavigation: {
          value: function() {
            $mdSidenav('opa').toggle();
          }
        },

        /**
         * Marks a menu item as selected.
         *
         * Both navigation menu and advanced navigation menu are updated.
         * The item with an "href" property corresponding to the given path will be selected,
         * selection on other items is removed.
         *
         * @memberof module:opa~OpaIndexController
         * @method selectMenuItem
         * @instance
         * @param {String} routePath The path of the item to select
         */
        selectMenuItem: {
          value: function(path) {
            var selectItem = function(navItem) {
              if (navItem.href === path)
                navItem.selected = true;
              else
                navItem.selected = false;
            };

            ctrl.navMenu.forEach(selectItem);
            ctrl.advancedNavMenu.forEach(selectItem);
          }
        }

      }

    );

    // Listen to route change start event
    $scope.$on('$routeChangeStart', function(event, next) {
      ctrl.isViewLoaded = false;
      if (!opaUserFactory.isAuthenticated()) ctrl.goToPortal();
    });

    // Listen to route change success event
    $scope.$on('$routeChangeSuccess', function(event, route) {
      ctrl.page.title = route &amp;&amp; route.title;
      ctrl.page.pageTitle = route &amp;&amp; route.pageTitle;
      ctrl.toolbarPageInfo.message = (route &amp;&amp; route.pageInfo) ? translateFilter(route.pageInfo) : null;
      ctrl.selectMenuItem(route.originalPath);
    });

    // Listen to view loaded event emitted by ng-views
    $scope.$on('opaViewLoaded', function() {
      ctrl.isViewLoaded = true;
    });

    // Listen to event informing about an HTTP error
    // On a not authenticated error log out the user
    // On other errors just inform the user by displaying a notification
    $scope.$on('opaHttpError', function(event, data) {
      if (data &amp;&amp; data.authenticationError)
        ctrl.logout();
      else
        opaNotificationFactory.displayNotification(data.message, 0);
    });

    ctrl.init();
  }

  app.controller('OpaIndexController', OpaIndexController);
  OpaIndexController.$inject = [
    '$scope',
    '$route',
    '$window',
    '$location',
    '$filter',
    '$mdMedia',
    '$mdSidenav',
    'opaUserFactory',
    'opaI18nFactory',
    'opaNotificationFactory'
  ];

})(angular.module('opa'));
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-opa.html">opa</a></li><li><a href="module-opa_actionsButton.html">opa/actionsButton</a></li><li><a href="module-opa_dashboard.html">opa/dashboard</a></li><li><a href="module-opa_dashboard_about.html">opa/dashboard/about</a></li><li><a href="module-opa_i18n.html">opa/i18n</a></li><li><a href="module-opa_info.html">opa/info</a></li><li><a href="module-opa_infoButton.html">opa/infoButton</a></li><li><a href="module-opa_licenseKeyValidator.html">opa/licenseKeyValidator</a></li><li><a href="module-opa_mediaContainer.html">opa/mediaContainer</a></li><li><a href="module-opa_mediaLibrary.html">opa/mediaLibrary</a></li><li><a href="module-opa_mediaLibraryDialog.html">opa/mediaLibraryDialog</a></li><li><a href="module-opa_mediaOption.html">opa/mediaOption</a></li><li><a href="module-opa_mediaSelect.html">opa/mediaSelect</a></li><li><a href="module-opa_nav.html">opa/nav</a></li><li><a href="module-opa_notification.html">opa/notification</a></li><li><a href="module-opa_promotedVideos.html">opa/promotedVideos</a></li><li><a href="module-opa_settings.html">opa/settings</a></li><li><a href="module-opa_settings_liveSettings.html">opa/settings/liveSettings</a></li><li><a href="module-opa_settings_searchSettings.html">opa/settings/searchSettings</a></li><li><a href="module-opa_streamUrlValidator.html">opa/streamUrlValidator</a></li><li><a href="module-opa_tags.html">opa/tags</a></li><li><a href="module-opa_toolbar.html">opa/toolbar</a></li></ul><h3>Classes</h3><ul><li><a href="module-opa_actionsButton-OpaActionsButtonController.html">opa/actionsButton~OpaActionsButtonController</a></li><li><a href="module-opa_dashboard_about-OpaAboutController.html">opa/dashboard/about~OpaAboutController</a></li><li><a href="module-opa_dashboard_about-OpaAboutFactory.html">opa/dashboard/about~OpaAboutFactory</a></li><li><a href="module-opa_dashboard-OpaDashboardController.html">opa/dashboard~OpaDashboardController</a></li><li><a href="module-opa_i18n-OpaI18nFactory.html">opa/i18n~OpaI18nFactory</a></li><li><a href="module-opa_i18n-OpaTranslateFilter.html">opa/i18n~OpaTranslateFilter</a></li><li><a href="module-opa_infoButton-OpaInfoButtonController.html">opa/infoButton~OpaInfoButtonController</a></li><li><a href="module-opa_info-OpaInfoConfiguration.html">opa/info~OpaInfoConfiguration</a></li><li><a href="module-opa_info-OpaInfoController.html">opa/info~OpaInfoController</a></li><li><a href="module-opa_licenseKeyValidator-OpaLicenseKeyValidatorController.html">opa/licenseKeyValidator~OpaLicenseKeyValidatorController</a></li><li><a href="module-opa_mediaContainer-OpaMediaContainerController.html">opa/mediaContainer~OpaMediaContainerController</a></li><li><a href="module-opa_mediaLibraryDialog-OpaMediaLibraryDialogController.html">opa/mediaLibraryDialog~OpaMediaLibraryDialogController</a></li><li><a href="module-opa_mediaLibrary-OpaMediaLibraryController.html">opa/mediaLibrary~OpaMediaLibraryController</a></li><li><a href="module-opa_mediaOption-OpaMediaOptionController.html">opa/mediaOption~OpaMediaOptionController</a></li><li><a href="module-opa_mediaSelect-OpaMediaSelectController.html">opa/mediaSelect~OpaMediaSelectController</a></li><li><a href="module-opa_nav-OpaNavController.html">opa/nav~OpaNavController</a></li><li><a href="module-opa_notification-OpaNotificationConfiguration.html">opa/notification~OpaNotificationConfiguration</a></li><li><a href="module-opa_notification-OpaNotificationController.html">opa/notification~OpaNotificationController</a></li><li><a href="module-opa_notification-OpaNotificationFactory.html">opa/notification~OpaNotificationFactory</a></li><li><a href="module-opa_promotedVideos-OpaPromotedVideosController.html">opa/promotedVideos~OpaPromotedVideosController</a></li><li><a href="module-opa_settings_liveSettings-OpaLiveSettingsController.html">opa/settings/liveSettings~OpaLiveSettingsController</a></li><li><a href="module-opa_settings_searchSettings-OpaSearchSettingsController.html">opa/settings/searchSettings~OpaSearchSettingsController</a></li><li><a href="module-opa_settings-OpaSettingsController.html">opa/settings~OpaSettingsController</a></li><li><a href="module-opa_streamUrlValidator-OpaStreamUrlValidatorController.html">opa/streamUrlValidator~OpaStreamUrlValidatorController</a></li><li><a href="module-opa_tags-OpaTagsController.html">opa/tags~OpaTagsController</a></li><li><a href="module-opa_toolbar-OpaToolbarController.html">opa/toolbar~OpaToolbarController</a></li><li><a href="module-opa-OpaGroupsFactory.html">opa~OpaGroupsFactory</a></li><li><a href="module-opa-OpaIndexController.html">opa~OpaIndexController</a></li><li><a href="module-opa-OpaInterceptor.html">opa~OpaInterceptor</a></li><li><a href="module-opa-OpaSettingsFactory.html">opa~OpaSettingsFactory</a></li><li><a href="module-opa-OpaUrlFactory.html">opa~OpaUrlFactory</a></li><li><a href="module-opa-OpaUserFactory.html">opa~OpaUserFactory</a></li><li><a href="module-opa-OpaVideosFactory.html">opa~OpaVideosFactory</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Tue Apr 05 2022 15:35:08 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
