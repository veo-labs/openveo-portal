"use strict";!function(a){var b=["ngRoute","ngAnimate","ngMaterial","ngMessages","ngSanitize","ngCookies","angulartics","angulartics.piwik","ov.locale","ov.i18n","ov.configuration","ov.player"],c=a.module("ov.portal",b);c.run(["$route","$rootScope","$location",function(a,b,c){var d=c.path;c.path=function(e,f){if(f===!1)var g=a.current,h=b.$on("$locationChangeSuccess",function(){a.current=g,h()});return d.apply(c,[e])}}]),c.config(["$mdDateLocaleProvider",function(b){var c=a.injector(["ng"]).get("$locale").id.slice(0,2);b.firstDayOfWeek=1,b.parseDate=function(a){var b=a.split("/");return"fr"==c?new Date(b[2],b[1]-1,b[0]):new Date(b[2],b[0]-1,b[1])},b.formatDate=function(a){if(a){var b=new Date(a),d=b.getDate(),e=b.getMonth()+1,f=b.getFullYear();return"fr"==c?d+"/"+e+"/"+f:e+"/"+d+"/"+f}return""}}]),c.config(["$routeProvider","$locationProvider","$httpProvider",function(b,c,d){b.when("/video/:mediaId",{templateUrl:"views/videoPage.html",controller:"VideoPageController",title:"VIDEO.PAGE_TITLE",resolve:{video:["$q","searchService","$route",function(a,b,c){var d=a.defer(),e=c.current.params.mediaId;return e?b.loadVideo(e).then(function(a){a.data.entity?d.resolve.apply(d,arguments):a.data.needAuth&&d.reject({redirect:"/authenticate"})},function(a){b.cacheClear(),d.reject({redirect:"/"})}):d.reject({redirect:"/"}),d.promise}]}}),b.when("/search",{templateUrl:"views/search.html",controller:"SearchController",title:"SEARCH.PAGE_TITLE",reloadOnSearch:!1,resolve:{result:["$location","searchService","$filter",function(b,c,d){var e=a.copy(b.search());e.sortBy=e.sortBy?"views":"date",e.sortOrder=e.sortOrder?"asc":"desc";var f=a.copy(e);if(f.dateStart&&(f.dateStart=d("date")(new Date(f.dateStart),"MM/dd/yyyy")),f.dateEnd){var g=new Date(f.dateEnd);g.setDate(g.getDate()+1),f.dateEnd=d("date")(g,"MM/dd/yyyy")}return e=c.cleanSearch(f),c.search(e,{})}],filters:["searchService",function(a){return a.getFilters()}]}}),b.when("/",{templateUrl:"views/home.html",controller:"HomeController",title:"HOME.PAGE_TITLE",resolve:{result:["searchService",function(a){return a.searchHomeVideos()}]}}).otherwise("/"),c.html5Mode(!0),d.interceptors.push("errorInterceptor")}])}(angular);;"use strict";!function(a,b){function c(a,b){var c,d;return a.data&&a.data.error&&(c=a.data.error.code,d=a.data.error.module),403===a.status?b("translate")("ERROR.FORBIDDEN"):400===a.status?b("translate")("ERROR.CLIENT")+" (code="+c+", module="+d+")":c&&d?b("translate")("ERROR.SERVER")+" (code="+c+", module="+d+")":b("translate")("ERROR.SERVER")}function d(a,b,d){return{responseError:function(a){return c(a,b),d.reject(a)}}}b.factory("errorInterceptor",d),d.$inject=["$rootScope","$filter","$q"]}(angular,angular.module("ov.portal"));;"use strict";!function(a){function b(a,b,c){a.videos=c&&c.data?c.data.entities:[],a.search={},a.searchSubmit=function(){b.path("/search").search(a.search)}}a.controller("HomeController",b),b.$inject=["$scope","$location","result"]}(angular.module("ov.portal"));;"use strict";!function(a){function b(a,b,c,d,e,f,g,h){function i(b){c(function(){var c=a.$root.$$phase;"$apply"===c||"$digest"===c?b():a.$apply(b)},1)}g.getCategoryName(a.video.category).then(function(b){a.categoryName=b}),a.dialIsOpen=!1,a.language=b.id,a.shareOpen=!1,a.shareItems=[{name:"UI.LINK",icon:"link",direction:"bottom",action:function(b){delete a.shareText;var c=80!=d.port()&&443!=d.port()?":"+d.port():"";a.shareLink=d.protocol()+"://"+d.host()+c+"/video/"+b.id,a.shareOpen=!a.shareOpen}},{name:"UI.CODE",icon:"code",direction:"left",action:function(b){delete a.shareLink;var c=80!=d.port()&&443!=d.port()?":"+d.port():"";a.shareText='<iframe width="768" height="500" src="'+d.protocol()+"://"+d.host()+c+"/video/"+b.id+'?iframe=true&hidedetail=false" frameborder="0"></iframe>',a.shareOpen=!a.shareOpen}}];var j,k,l=document.getElementById("openveo-player");angular.element(l).on("durationChange",function(a,b){i(function(){k=b,j&&!b||(j=angular.element(l).controller("ovPlayer"))})}),angular.element(l).on("ovPlay",function(b){e.pageTrack(d.path()),e.eventTrack("play",{value:a.video.id}),f.increaseVideoView(a.video.id,k)}),angular.element(l).on("error",function(b,c){a.$emit("setAlert","danger",c&&c.message,8e3)}),a.$watch("vctl.dialIsOpen",function(b,c){b===!0&&(a.shareOpen=!1)}),a.trustedHTML=function(a){return h.trustAsHtml(a)}}a.controller("VideoController",b),b.$inject=["$scope","$locale","$timeout","$location","$analytics","videoService","searchService","$sce"]}(angular.module("ov.portal"));;"use strict";!function(a){function b(a,b){a.video=b.data.entity,a.playerType="youtube"==a.video.type?"youtube":"html"}a.controller("VideoPageController",b),b.$inject=["$scope","video"]}(angular.module("ov.portal"));;"use strict";!function(a){function b(a,b){a.closeToast=function(){b.hide()}}function c(a,b,c,d){a.video=c,a.playerType="youtube"==c.type?"youtube":"html",a.dialogIsFull=d("sm")||d("xs"),a.hide=function(){b.hide()},a.cancel=function(){b.cancel()},a.$watch(function(){return d("sm")||d("xs")},function(b){a.dialogIsFull=b===!0})}function d(a,b,d,e,f,g,h,i,j,k){var l=h.search();b.context={keepContext:!1},b.isIframe=l.iframe||!1,b.hideDetailVideo=l.hidedetail||!1,b.links=0===Object.keys(d).length&&JSON.stringify(d)===JSON.stringify({})?null:d,b.page={title:"",path:"",selectedTab:-1},b.$on("$routeChangeSuccess",function(c,d){b.page.title=a.current&&a.current.title||b.title,b.page.path=h.path(),b.page.selectedTab=-1,k.pageTrack(b.page.path)}),b.$on("$routeChangeError",function(a,c,d,e){e&&e.redirect?"/authenticate"==e.redirect?window.location.href=e.redirect:h.path(e.redirect):(h.path("/"),"500"!=e.status&&"502"!=e.status||b.showToast(i("translate")("ERROR.SERVER")))}),b.openVideo=function(a,d){if(!b.useDialog)return void h.path("/video/"+d.id,!0);b.context.keepContext=!1;var f=h.path(),k=h.search();b.dialogUseFullScreen=g("sm")||g("xs"),b.dialog={controller:c,templateUrl:"views/dialogVideo.html",parent:angular.element(document.body),targetEvent:a,locals:{video:null},clickOutsideToClose:!0,fullscreen:b.dialogUseFullScreen},j.loadVideo(d.id).then(function(a){a.data.entity?(h.path("/video/"+d.id,!1).search({}),b.dialog.locals.video=a.data.entity,e.show(b.dialog).finally(function(){b.context.keepContext=!0,h.path(f,!1).search(k)}).catch(angular.noop)):a.data.needAuth?window.location.href="/authenticate":h.path("/")},function(a){j.cacheClear(),h.path("/"),"500"!=a.status&&"502"!=a.status||b.showToast(i("translate")("ERROR.SERVER"))}),b.$watch(function(){return g("sm")||g("xs")},function(a){b.dialogUseFullScreen=a===!0})},b.onTabSelected=function(a){"/search"==a?h.path(a):h.path(a).search({})},b.showToast=function(a){var b=f.simple().textContent(a).position("top center").hideDelay(3e3);f.show(b)}}function e(a){return{restrict:"A",link:function(b,c,d){d.$observe("ngSrc",function(d){a.get(d).then(function(){}).catch(function(){c.attr("src","/themes/"+b.theme+"/images/placeholder.jpg")})})}}}a.controller("MainController",d),a.controller("DialogController",c),a.controller("ToastController",b),d.$inject=["$route","$scope","links","$mdDialog","$mdToast","$mdMedia","$location","$filter","searchService","$analytics"],c.$inject=["$scope","$mdDialog","video","$mdMedia"],b.$inject=["$scope","$mdToast"],e.$inject=["$http"],a.directive("checkImage",e)}(angular.module("ov.portal"));;"use strict";!function(a){function b(a,b){function c(c){return!o[c]||o[c].needAuth?a.get(n+"getvideo/"+c).then(function(a){return o[c]=a.data.entity,a}):b.when({data:{entity:o[c]}})}function d(){return k&&Object.keys(k).length?b.when({data:k}):a.get(n+"filters").then(function(a){return k=a.data,a})}function e(){return l&&Object.keys(l).length?b.when({data:l}):a.get(n+"categories").then(function(a){return l=a.data,a})}function f(a){var b=this;return b.getCategories().then(function(b){return b.data.values[a]})}function g(){if(!m||!Object.keys(m).length){var c={filter:{sortBy:"date",sortOrder:"desc"},pagination:{page:0,limit:6}};return a.post(n+"search",c).then(function(a){return m=a.data,a})}return b.when({data:m})}function h(b,c,d){var e={};d&&(e.timeout=d);var f={filter:b,pagination:c};return a.post(n+"search",f,e)}function i(){o={},k={},l={},m={}}function j(a){var b=Object.keys(a),c=angular.copy(a);return b.map(function(b){""!==c[b]&&c[b]!==!1&&"false"!==c[b]||delete a[b]}),a}var k,l,m,n="/",o={};return{cacheClear:i,loadVideo:c,getFilters:d,getCategories:e,getCategoryName:f,searchHomeVideos:g,search:h,cleanSearch:j}}a.factory("searchService",b),b.$inject=["$http","$q"]}(angular.module("ov.portal"));;"use strict";!function(a){function b(a,b,c,d,e,f,g,h){function i(b){b.dateStart&&(b.dateStart=new Date(b.dateStart)),b.dateEnd&&(b.dateEnd=new Date(b.dateEnd)),a.search=angular.copy(b)}function j(){a.isLoading=!0,l&&l.resolve(),l=c.defer();var f=angular.copy(a.search),g=angular.copy(a.pagination);if(f.sortBy=f.sortBy?"views":"date",f.sortOrder=f.sortOrder?"asc":"desc",f.dateStart=d("date")(a.search.dateStart,"MM/dd/yyyy"),a.search.dateEnd){var i=angular.copy(a.search.dateEnd);i.setDate(i.getDate()+1),f.dateEnd=d("date")(i,"MM/dd/yyyy")}e.search(f,g,l).then(function(c){if(c.data.error)return a.isLoading=!1,void a.showToast("error");a.videos=c.data.entities,a.search=b.search(),a.pagination=c.data.pagination,a.isLoading=!1,k=!0;var d=a.search.query?a.search.query:"",e=a.search.categories?a.search.categories:"";h.trackSiteSearch(d,e,a.pagination.size)})}var k=!1,l=c.defer();a.videos=f.data.entities||[],a.filters=g.data||[],a.pagination=angular.extend(a.pagination?a.pagination:{},f.data.pagination),a.showAdvancedSearch=!1,a.isLoading=!1,i(b.search()),a.searchSubmit=function(){var c=angular.copy(a.search);a.showAdvancedSearch=!1,a.search=e.cleanSearch(c),b.search(a.search)},a.resetSearch=function(){i({query:a.search.query})},a.orderOnChange=function(){a.searchSubmit()},a.$watch("pagination.pages",function(b,c){for(var d=[],e=1;e<=b;e++)d.push(e);a.pages=d}),a.$watch("pagination.page",function(b,c){a.pagination.page=b,k?j():k=!0}),a.$on("$routeUpdate",function(c,d){a.search=b.search(),a.context&&a.context.keepContext?a.context.keepContext=!1:(k=!1,a.pagination.page=0,j())})}a.controller("SearchController",b),b.$inject=["$scope","$location","$q","$filter","searchService","result","filters","$analytics"]}(angular.module("ov.portal"));;"use strict";!function(a){function b(a,b){function c(c,e){if(!b.get(c)&&e)return a.post(d+"statistics/video/views/"+c).then(function(){var a=new Date,d=new Date(a.getTime()+e);b.put(c,!0,{expires:d})})}var d="/";return{increaseVideoView:c}}a.factory("videoService",b),b.$inject=["$http","$cookies"]}(angular.module("ov.portal"));